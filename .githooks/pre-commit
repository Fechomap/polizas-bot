#!/bin/bash

# =============================================================================
# PRE-COMMIT HOOK
# =============================================================================
# Este hook se ejecuta autom√°ticamente antes de cada commit.
# Si alg√∫n paso falla, el commit se cancela.
# =============================================================================

set -e  # Salir inmediatamente si un comando falla

echo ""
echo "=========================================="
echo "  PRE-COMMIT: Validando c√≥digo..."
echo "=========================================="
echo ""

# 1. Format con Prettier
echo "üìù [1/4] Ejecutando Prettier (format)..."
npm run format
if [ $? -ne 0 ]; then
    echo "‚ùå Error en Prettier. Commit cancelado."
    exit 1
fi
echo "‚úÖ Prettier completado"
echo ""

# 2. ESLint con fix
echo "üîç [2/4] Ejecutando ESLint (lint:fix)..."
npm run lint:fix
if [ $? -ne 0 ]; then
    echo "‚ùå Error en ESLint. Commit cancelado."
    exit 1
fi
echo "‚úÖ ESLint completado"
echo ""

# 3. Type-check con TypeScript
echo "üì¶ [3/4] Ejecutando TypeScript (type-check)..."
npm run type-check
if [ $? -ne 0 ]; then
    echo "‚ùå Error en TypeScript type-check. Commit cancelado."
    exit 1
fi
echo "‚úÖ Type-check completado"
echo ""

# 4. Build
echo "üî® [4/4] Ejecutando Build..."
npm run build
if [ $? -ne 0 ]; then
    echo "‚ùå Error en Build. Commit cancelado."
    exit 1
fi
echo "‚úÖ Build completado"
echo ""

# Agregar archivos modificados por prettier/eslint al commit
git add -u

echo "=========================================="
echo "  ‚úÖ PRE-COMMIT: Todas las validaciones pasaron"
echo "=========================================="
echo ""

exit 0
